
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>14. Dimensionality Reduction &#8212; Introduction to Data Science (for not-yet-scientists)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/live_coding_07_dimensionality_reduction';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="15. Machine Learning - Introduction" href="live_coding_08_machine_learning.html" />
    <link rel="prev" title="13. Outlier Detection" href="live_coding_06b_introduction_outlier_detection.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../book/cover.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/data_science_cover_illustration_logo.png" class="logo__image only-light" alt="Introduction to Data Science (for not-yet-scientists) - Home"/>
    <script>document.write(`<img src="../_static/data_science_cover_illustration_logo.png" class="logo__image only-dark" alt="Introduction to Data Science (for not-yet-scientists) - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../book/cover.html">
                    Introduction to Data Science (for not-yet scientists)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/intro.html">1. Introduction: Data Science for Not-Yet-Scientists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/01_intro_data_science.html">2. What is Data Science?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/02_data_science_ethics_society.html">3. Data Science, Ethics, and Society</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/03_use_of_this_book.html">4. How to use this book (… if you ask us)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Science Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/04_data_and_types.html">5. Data and Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/05_data_information_knowledge.html">6. Data - Information - Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/06_data_science_workflow.html">7. Data Science Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data acquisition and first exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/07_data_acquisition_and_preparation.html">8. Data Acquisition &amp; Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_03_data_preparation.html">9. Data Pre-Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_04_distributions_statistical_measures.html">10. First Data Exploration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">In-depth Data Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="live_coding_05_correlation_analysis.html">11. Correlation Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_06_clustering.html">12. Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_06b_introduction_outlier_detection.html">13. Outlier Detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Modeling</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">14. Dimensionality Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_08_machine_learning.html">15. Machine Learning - Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_09_machine_learning_algorithms.html">16. Machine Learning - Common Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_09b_machine_learning_algorithms_2.html">17. Machine Learning - Common Algorithms II (Linear Models)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Working with text data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="live_coding_10_working_with_text_data.html">18. Introduction to Working with Text Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_11_NLP_2_tokenization.html">19. NLP - basic techniques to analyse text data</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_11_NLP_3_tfifd_and_machine_learning.html">20. Computing with Text: Counting words</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_12_NLP_4_ngrams_word_vectors.html">21. Beyond Counting Individual Words: N-grams</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Look at the networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="live_coding_13_graphs.html">22. Networks / Graph Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_14_graph_visualization.html">23. Visualizing Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="live_coding_14_graphs_part2.html">24. Bottlenecks, Hubs, Communities</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Next steps</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="outlook.html">25. What are the next steps?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/bibliography.html">Bibliography</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Source Code and Contributions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/github.html">Source Code on GitHub</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/florian-huber/data_science_course" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/florian-huber/data_science_course/issues/new?title=Issue%20on%20page%20%2Fnotebooks/live_coding_07_dimensionality_reduction.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/live_coding_07_dimensionality_reduction.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Dimensionality Reduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-dimensionality-reduction">14.1. Introduction to Dimensionality Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-challenge-of-high-dimensional-data">14.1.1. The Challenge of High-Dimensional Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implications">14.1.2. Practical Implications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-dimensionality-reduction">14.1.3. The Role of Dimensionality Reduction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">14.2. Feature Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-1-feature-projection">14.3. Feature Extraction 1: Feature Projection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-projection">14.3.1. Feature Projection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-principal-component-analysis">14.3.2. PCA (Principal Component Analysis)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#concept">14.3.2.1. Concept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-example-with-python">14.3.2.2. Practical Example with Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-synthetic-data">14.3.2.3. Generating Synthetic Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pca">14.3.2.4. Applying PCA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-marketing-analysis-with-pca">14.3.3. Use Case: Marketing Analysis (with PCA)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-import-and-inspection">14.3.3.1. Data import and inspection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">14.3.3.2. Data cleaning</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-processing">14.3.3.3. Data processing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-linear-projections">14.3.4. Non-linear Projections</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-on-generated-2d-test-data">14.3.5. PCA on generated 2D test data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-pca">14.3.6. Kernel-PCA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-2-manifold-learning">14.4. Feature Extraction 2: Manifold Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-sne">14.4.1. t-SNE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#umap-uniform-manifold-approximation-and-projection">14.4.2. UMAP (Uniform Manifold Approximation and Projection)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-and-application">14.4.3. Comparison and Application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-marketing-analysis-t-sne">14.4.4. Use case: Marketing Analysis (t-SNE)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">14.5. Conclusions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="dimensionality-reduction">
<span id="ch-dimensionality"></span><h1><span class="section-number">14. </span>Dimensionality Reduction<a class="headerlink" href="#dimensionality-reduction" title="Link to this heading">#</a></h1>
<section id="introduction-to-dimensionality-reduction">
<h2><span class="section-number">14.1. </span>Introduction to Dimensionality Reduction<a class="headerlink" href="#introduction-to-dimensionality-reduction" title="Link to this heading">#</a></h2>
<p>In the field of data science, we frequently encounter multi-dimensional data. Dimensional here simply means that each data point comprises multiple variables or features. While we can represent and manipulate such data in tabular form, visual and computational challenges arise as the number of dimensions increases.</p>
<section id="the-challenge-of-high-dimensional-data">
<h3><span class="section-number">14.1.1. </span>The Challenge of High-Dimensional Data<a class="headerlink" href="#the-challenge-of-high-dimensional-data" title="Link to this heading">#</a></h3>
<p>Consider data that include age, weight, and height. This can still be visually represented in a 3D scatter plot. But what happens when we introduce additional variables such as working hours, income, wealth, and eye color? We could add a few more dimensions to the plot by using color or size of the symbols. At some point, however, representing all these variables simultaneously in a single plot becomes unfeasible.</p>
<p>This leads us to a broader issue known as the <strong>curse of dimensionality</strong>. This concept refers to the exponential increase in volume associated with adding extra dimensions to Euclidean space. For example, representing 100 elevation points along a 100m line is straightforward. However, describing a 100m x 100m area requires 10,000 points for the same resolution, and the complexity only grows as more dimensions are added.</p>
</section>
<section id="practical-implications">
<h3><span class="section-number">14.1.2. </span>Practical Implications<a class="headerlink" href="#practical-implications" title="Link to this heading">#</a></h3>
<p>With a thousand data points, it’s relatively simple to cover a 2D or 3D space adequately, capturing diverse combinations of age, weight, and height. However, if each of these data points features 20 additional properties, like income, shoe size, and eye color, the number of data points required to adequately describe this 23-dimensional space increases dramatically. This vast expansion in dimensionality makes it challenging to find closely matching profiles in the dataset. For instance, two people might share similar basic physical characteristics, but differ significantly across other dimensions such as income or vacation days.</p>
<p>Thus, high dimensionality not only complicates the graphical representation of data but also poses significant challenges in areas like clustering and predictive modeling. As dimensions increase, data points tend to become sparser, leading to overfitting in machine learning models and a general decrease in model performance.</p>
<figure class="align-default" id="fig-dimensionality-reduction01">
<img alt="../_images/fig_curse_of_dimensionality_01.png" src="../_images/fig_curse_of_dimensionality_01.png" />
<figcaption>
<p><span class="caption-number">Fig. 14.1 </span><span class="caption-text">In many cases, we will work with data that has more than just 2 or 3 relevant features (or: dimensions). While age, weight, and height might all be of interest when we analyze a dataset of people, it is not very likely that this will be sufficient to reveal very interesting patterns. We can easily plot 2 or 3 features (see (a)). But what do we do if we want to add additional features, maybe even <em>many</em> additional features?
The <em>curse of dimensionality</em> can be understood by imagining that we have to fully explore a feature space. 2D and 3D are relatively straightforward, but when we have to cover a much higher dimensional space, we simply need far too many datapoints to <em>cover</em> this space reasonably well (see (b)).</span><a class="headerlink" href="#fig-dimensionality-reduction01" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="the-role-of-dimensionality-reduction">
<h3><span class="section-number">14.1.3. </span>The Role of Dimensionality Reduction<a class="headerlink" href="#the-role-of-dimensionality-reduction" title="Link to this heading">#</a></h3>
<p>To address these challenges, <strong>dimensionality reduction</strong> techniques are employed extensively in data science. These techniques strive to retain the most critical information in the data while reducing the number of dimensions involved. This can be viewed as a form of data compression that simplifies large datasets, making them easier to explore and analyze.</p>
<p>Dimensionality reduction is beneficial not only for simplifying data visualization but also for enhancing the performance of analytical models by reducing the computational burden and minimizing the risk of overfitting.</p>
<p>Luckily, we -as (future) data scientists- can make use of a wide variety of powerful techniques to reduce the number of our feature dimensions (see <a class="reference internal" href="#fig-dimensionality-reduction-techniques"><span class="std std-numref">Fig. 14.2</span></a>). But, before we start to look at the different methods, a brief warning: In nearly all cases, dimensionality reduction comes with a <strong>trade-off between reduction of dimensions and information loss</strong>. No matter which method we will use to reduce 20-dimensional data to 2-dimensional data, some information will be lost in the process.</p>
<figure class="align-default" id="fig-dimensionality-reduction-techniques">
<img alt="../_images/fig_dimensionality_reduction_techniques.png" src="../_images/fig_dimensionality_reduction_techniques.png" />
<figcaption>
<p><span class="caption-number">Fig. 14.2 </span><span class="caption-text">There are many different approaches to reducing the number of feature dimensions in data. <strong>Feature selection</strong> techniques aim at picking a subset of original features without transformation. <strong>Feature extraction</strong> techniques transform original features into a lower-dimensional space while capturing important information. Two important categories for such extraction processes are <em>projection-based</em> and <em>manifold-learning</em> and in each category we can find numerous, often very different, algorithms, a few of which are listed in this figure.</span><a class="headerlink" href="#fig-dimensionality-reduction-techniques" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="feature-selection">
<h2><span class="section-number">14.2. </span>Feature Selection<a class="headerlink" href="#feature-selection" title="Link to this heading">#</a></h2>
<p>A variant of dimensionality reduction is <strong>feature selection</strong>, which involves identifying and removing less important features for a specific task. Common methods include:</p>
<ul class="simple">
<li><p><strong>High Correlation Filter</strong>: Removes features that are highly correlated with others, reducing redundancy.</p></li>
<li><p><strong>Low Variance Filter</strong>: Eliminates features that show little variation, which are presumed to contribute less information.</p></li>
<li><p><strong>Missing Value Threshold</strong>: Discards features with too many missing values, which might undermine model reliability.</p></li>
<li><p><strong>Feature Importance from Models</strong>: Utilizes models like Random Forest to identify and keep the most informative features.</p></li>
</ul>
<p>Feature selection methods offer the advantage of simplicity and interpretability. No abstract features are created, and the results are usually straightforward and easy to replicate.</p>
<p>However, in practice, especially with high-dimensional data, the drawbacks often outweigh these advantages. For one, feature selection typically achieves only modest data compression, meaning that even large datasets retain many dimensions. Moreover, determining which features are important can be challenging, requiring extensive domain knowledge and a clear understanding of the questions being addressed.</p>
</section>
<section id="feature-extraction-1-feature-projection">
<h2><span class="section-number">14.3. </span>Feature Extraction 1: Feature Projection<a class="headerlink" href="#feature-extraction-1-feature-projection" title="Link to this heading">#</a></h2>
<p><strong>Feature extraction</strong> involves transforming original features into a lower-dimensional space. This transformation can be designed to retain as much of the important information as possible while reducing dimensionality. One popular category of feature extraction is <strong>feature projection</strong>.</p>
<section id="feature-projection">
<h3><span class="section-number">14.3.1. </span>Feature Projection<a class="headerlink" href="#feature-projection" title="Link to this heading">#</a></h3>
<p>Feature projection techniques aim to map high-dimensional data onto a lower-dimensional space through a linear or non-linear transformation, focusing on maintaining the integrity of the data’s structure as much as possible.</p>
<ul class="simple">
<li><p><strong>Linear Projections</strong>:</p>
<ul>
<li><p><strong>Principal Component Analysis (PCA)</strong>: Reduces dimensionality by transforming features into a new coordinate system, where the greatest variance by any projection of the data comes to lie on the first coordinate (called the first principal component), the second greatest variance on the second coordinate, and so on.</p></li>
<li><p><strong>Linear Discriminant Analysis (LDA)</strong>: Seeks directions that maximize the separation between multiple classes.</p></li>
</ul>
</li>
<li><p><strong>Non-linear Projections</strong>:</p>
<ul>
<li><p><strong>Kernel PCA</strong>: Extends PCA to non-linear dimension reduction through the use of kernels, allowing the algorithm to perform complex mappings that linear methods cannot.</p></li>
</ul>
</li>
</ul>
<p>These projection methods can be highly effective for pattern recognition and machine learning tasks where the intrinsic dimensionality of the data is lower than the number of measured variables. They are particularly valuable when the goal is to simplify the data without losing critical information, facilitating faster and more efficient processing.</p>
</section>
<section id="pca-principal-component-analysis">
<h3><span class="section-number">14.3.2. </span>PCA (Principal Component Analysis)<a class="headerlink" href="#pca-principal-component-analysis" title="Link to this heading">#</a></h3>
<p>Principal Component Analysis (PCA) is a cornerstone technique in dimensionality reduction, used extensively to simplify the complexity inherent in multi-dimensional data. This simplification aids in improving data interpretability, visualizations, and can even enhance the performance of machine learning algorithms by eliminating noise and redundancy. Below we detail the mechanisms of PCA and its practical application.</p>
<section id="concept">
<h4><span class="section-number">14.3.2.1. </span>Concept<a class="headerlink" href="#concept" title="Link to this heading">#</a></h4>
<p>PCA systematically transforms the original correlated features into a new set of uncorrelated features, called principal components, ordered so that the first few retain most of the variation present in all of the original dimensions.</p>
<p><strong>Key steps in PCA:</strong></p>
<ol class="arabic">
<li><p><strong>Standardization</strong>:</p>
<ul>
<li><p><strong>Purpose</strong>: PCA is affected by the scale of the features, as features with larger scales dominate the variance. Thus, standardizing the data (giving each feature zero mean and unit variance) ensures that each feature contributes equally.</p></li>
<li><p><strong>Method</strong>:</p>
<p>Each feature <span class="math notranslate nohighlight">\(x_i\)</span> of the dataset is transformed as follows:</p>
<div class="math notranslate nohighlight">
\[x_i' = \frac{x_i − \mu_i}{\sigma_i}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu_i\)</span> is the mean and <span class="math notranslate nohighlight">\(\sigma_i\)</span> is the standard deviation of the feature <span class="math notranslate nohighlight">\(x_i\)</span>.</p>
</li>
</ul>
</li>
<li><p><strong>Covariance Matrix Computation</strong>:</p>
<ul>
<li><p><strong>Purpose</strong>: The covariance matrix captures the pairwise covariances of features and reflects how changes in one feature correspond with changes in another.</p></li>
<li><p><strong>Method</strong>:</p>
<div class="math notranslate nohighlight">
\[
     \Sigma  = \frac{1}{n-1} \left( X - \bar{X} \right)^T \left( X - \bar{X} \right)
     \]</div>
<p>where <span class="math notranslate nohighlight">\(X\)</span> is the feature matrix and <span class="math notranslate nohighlight">\(\bar{X}\)</span> is the matrix of feature means.</p>
</li>
</ul>
</li>
<li><p><strong>Eigenvalue Decomposition</strong>:</p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Decomposing the covariance matrix to extract its eigenvalues and eigenvectors identifies the new axes (principal components) that maximize the variance of the data when projected onto them.</p></li>
<li><p><strong>Method</strong>:
Solve the equation <span class="math notranslate nohighlight">\(\Sigma v = \lambda v\)</span>, where <span class="math notranslate nohighlight">\(\lambda\)</span> represents the eigenvalues, and <span class="math notranslate nohighlight">\(v\)</span> represents the corresponding eigenvectors. The eigenvectors define the directions of the new space, and the eigenvalues define their magnitude, indicating the amount of variance carried in each principal component.</p></li>
</ul>
</li>
<li><p><strong>Selection of Principal Components</strong>:</p>
<ul class="simple">
<li><p><strong>Criteria</strong>: Principal components are selected based on the magnitude of their eigenvalues in descending order. Components with the highest eigenvalues are chosen because they capture the most variance of the data set.</p></li>
<li><p><strong>Outcome</strong>: The first few principal components often capture the majority of the variation, allowing for a significant reduction in dimensionality without substantial loss of information.</p></li>
</ul>
</li>
</ol>
</section>
<section id="practical-example-with-python">
<h4><span class="section-number">14.3.2.2. </span>Practical Example with Python<a class="headerlink" href="#practical-example-with-python" title="Link to this heading">#</a></h4>
<p>We’ll create a 2D dataset and apply PCA to reduce it to 1D. First, we’ll generate a synthetic dataset.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="generating-synthetic-data">
<h4><span class="section-number">14.3.2.3. </span>Generating Synthetic Data<a class="headerlink" href="#generating-synthetic-data" title="Link to this heading">#</a></h4>
<p>Let’s create a dataset of 2 features with a clear linear relationship.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generating a synthetic 2D dataset</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># Standardizing the dataset</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_std</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="applying-pca">
<h4><span class="section-number">14.3.2.4. </span>Applying PCA<a class="headerlink" href="#applying-pca" title="Link to this heading">#</a></h4>
<p>We will then standardize this data and apply PCA to reduce its dimensionality.
To inspect the results, we will use a simple scatter plot visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Applying PCA to reduce dimensionality from 2D to 1D</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the original data and the principal component</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Original Data (before PCA)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Original Data (2D)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Feature 2&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Data after PCA transformation</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Data after PCA (1D)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Principal Component 1&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/097bc2612634b82aa72ff90318112adf846dd58ed07c30853e2b16399a21e5a8.png" src="../_images/097bc2612634b82aa72ff90318112adf846dd58ed07c30853e2b16399a21e5a8.png" />
</div>
</div>
<p>In the figures above, we can see a clear demonstration of PCA in action:</p>
<ol class="arabic simple">
<li><p>Original Data (2D): The left plot shows our synthetic 2D dataset. The dataset exhibits a linear relationship between the two features, making it a good candidate for PCA.</p></li>
<li><p>Data after PCA (1D): The right plot shows the data after applying PCA and reducing its dimensionality to 1D. This plot represents the projection of the original data onto the first principal component. This principal component is a line that best represents the variance in the dataset.</p></li>
</ol>
<p>By transforming the data onto this principal component, we’ve effectively reduced its dimensionality while retaining the most important variance in the data. PCA has simplified the dataset, making it easier to analyze and visualize, and potentially improving the efficiency and performance of subsequent data processing or machine learning algorithms. ​
​</p>
</section>
</section>
<section id="use-case-marketing-analysis-with-pca">
<h3><span class="section-number">14.3.3. </span>Use Case: Marketing Analysis (with PCA)<a class="headerlink" href="#use-case-marketing-analysis-with-pca" title="Link to this heading">#</a></h3>
<p>Let’s now move to a more realistic use case to show what the dimensionality reduction method can be used for.
In the following part, we will look at data from a marketing campaign, or more generally, data from an online store (<a class="reference external" href="https://www.kaggle.com/datasets/ahsan81/superstore-marketing-campaign-dataset">link to the dataset</a>). In the first step, we will import and inspect the data. Then, we will clean and process the data a little before we can actually apply <code class="docutils literal notranslate"><span class="pre">PCA</span></code> to reduce the data to two dimensions.</p>
<section id="data-import-and-inspection">
<h4><span class="section-number">14.3.3.1. </span>Data import and inspection<a class="headerlink" href="#data-import-and-inspection" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_data</span> <span class="o">=</span> <span class="s2">&quot;../datasets/&quot;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;superstore_data.csv&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_data</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Id&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year_Birth</th>
      <th>Education</th>
      <th>Marital_Status</th>
      <th>Income</th>
      <th>Kidhome</th>
      <th>Teenhome</th>
      <th>Dt_Customer</th>
      <th>Recency</th>
      <th>MntWines</th>
      <th>MntFruits</th>
      <th>...</th>
      <th>MntFishProducts</th>
      <th>MntSweetProducts</th>
      <th>MntGoldProds</th>
      <th>NumDealsPurchases</th>
      <th>NumWebPurchases</th>
      <th>NumCatalogPurchases</th>
      <th>NumStorePurchases</th>
      <th>NumWebVisitsMonth</th>
      <th>Response</th>
      <th>Complain</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1826</th>
      <td>1970</td>
      <td>Graduation</td>
      <td>Divorced</td>
      <td>84835.0</td>
      <td>0</td>
      <td>0</td>
      <td>6/16/2014</td>
      <td>0</td>
      <td>189</td>
      <td>104</td>
      <td>...</td>
      <td>111</td>
      <td>189</td>
      <td>218</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1961</td>
      <td>Graduation</td>
      <td>Single</td>
      <td>57091.0</td>
      <td>0</td>
      <td>0</td>
      <td>6/15/2014</td>
      <td>0</td>
      <td>464</td>
      <td>5</td>
      <td>...</td>
      <td>7</td>
      <td>0</td>
      <td>37</td>
      <td>1</td>
      <td>7</td>
      <td>3</td>
      <td>7</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10476</th>
      <td>1958</td>
      <td>Graduation</td>
      <td>Married</td>
      <td>67267.0</td>
      <td>0</td>
      <td>1</td>
      <td>5/13/2014</td>
      <td>0</td>
      <td>134</td>
      <td>11</td>
      <td>...</td>
      <td>15</td>
      <td>2</td>
      <td>30</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>1967</td>
      <td>Graduation</td>
      <td>Together</td>
      <td>32474.0</td>
      <td>1</td>
      <td>1</td>
      <td>11/5/2014</td>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5371</th>
      <td>1989</td>
      <td>Graduation</td>
      <td>Single</td>
      <td>21474.0</td>
      <td>1</td>
      <td>0</td>
      <td>8/4/2014</td>
      <td>0</td>
      <td>6</td>
      <td>16</td>
      <td>...</td>
      <td>11</td>
      <td>0</td>
      <td>34</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2d7957e05b97000a23e3877611cd9b173c497151363adf31c391da77cdfb89ec.png" src="../_images/2d7957e05b97000a23e3877611cd9b173c497151363adf31c391da77cdfb89ec.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Index: 2216 entries, 1826 to 4070
Data columns (total 21 columns):
 #   Column               Non-Null Count  Dtype  
---  ------               --------------  -----  
 0   Year_Birth           2216 non-null   int64  
 1   Education            2216 non-null   object 
 2   Marital_Status       2216 non-null   object 
 3   Income               2216 non-null   float64
 4   Kidhome              2216 non-null   int64  
 5   Teenhome             2216 non-null   int64  
 6   Dt_Customer          2216 non-null   object 
 7   Recency              2216 non-null   int64  
 8   MntWines             2216 non-null   int64  
 9   MntFruits            2216 non-null   int64  
 10  MntMeatProducts      2216 non-null   int64  
 11  MntFishProducts      2216 non-null   int64  
 12  MntSweetProducts     2216 non-null   int64  
 13  MntGoldProds         2216 non-null   int64  
 14  NumDealsPurchases    2216 non-null   int64  
 15  NumWebPurchases      2216 non-null   int64  
 16  NumCatalogPurchases  2216 non-null   int64  
 17  NumStorePurchases    2216 non-null   int64  
 18  NumWebVisitsMonth    2216 non-null   int64  
 19  Response             2216 non-null   int64  
 20  Complain             2216 non-null   int64  
dtypes: float64(1), int64(17), object(3)
memory usage: 380.9+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-cleaning">
<h4><span class="section-number">14.3.3.2. </span>Data cleaning<a class="headerlink" href="#data-cleaning" title="Link to this heading">#</a></h4>
<p>Some values appear weird, for instance in the column <code class="docutils literal notranslate"><span class="pre">Year_Birth</span></code>. In addition, we might want to remove some “outliers”, i.e., rare cases in which we might not be so interested. Here, this could be the few people with enormously high incomes (independent of whether those values are true or not…).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Income&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">150000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Year_Birth&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1925</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year_Birth</th>
      <th>Education</th>
      <th>Marital_Status</th>
      <th>Income</th>
      <th>Kidhome</th>
      <th>Teenhome</th>
      <th>Dt_Customer</th>
      <th>Recency</th>
      <th>MntWines</th>
      <th>MntFruits</th>
      <th>...</th>
      <th>MntFishProducts</th>
      <th>MntSweetProducts</th>
      <th>MntGoldProds</th>
      <th>NumDealsPurchases</th>
      <th>NumWebPurchases</th>
      <th>NumCatalogPurchases</th>
      <th>NumStorePurchases</th>
      <th>NumWebVisitsMonth</th>
      <th>Response</th>
      <th>Complain</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1826</th>
      <td>1970</td>
      <td>Graduation</td>
      <td>Divorced</td>
      <td>84835.0</td>
      <td>0</td>
      <td>0</td>
      <td>6/16/2014</td>
      <td>0</td>
      <td>189</td>
      <td>104</td>
      <td>...</td>
      <td>111</td>
      <td>189</td>
      <td>218</td>
      <td>1</td>
      <td>4</td>
      <td>4</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1961</td>
      <td>Graduation</td>
      <td>Single</td>
      <td>57091.0</td>
      <td>0</td>
      <td>0</td>
      <td>6/15/2014</td>
      <td>0</td>
      <td>464</td>
      <td>5</td>
      <td>...</td>
      <td>7</td>
      <td>0</td>
      <td>37</td>
      <td>1</td>
      <td>7</td>
      <td>3</td>
      <td>7</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10476</th>
      <td>1958</td>
      <td>Graduation</td>
      <td>Married</td>
      <td>67267.0</td>
      <td>0</td>
      <td>1</td>
      <td>5/13/2014</td>
      <td>0</td>
      <td>134</td>
      <td>11</td>
      <td>...</td>
      <td>15</td>
      <td>2</td>
      <td>30</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1386</th>
      <td>1967</td>
      <td>Graduation</td>
      <td>Together</td>
      <td>32474.0</td>
      <td>1</td>
      <td>1</td>
      <td>11/5/2014</td>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5371</th>
      <td>1989</td>
      <td>Graduation</td>
      <td>Single</td>
      <td>21474.0</td>
      <td>1</td>
      <td>0</td>
      <td>8/4/2014</td>
      <td>0</td>
      <td>6</td>
      <td>16</td>
      <td>...</td>
      <td>11</td>
      <td>0</td>
      <td>34</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<p>Here, we also use some <strong>feature manipulation</strong> to change features into a easier-to-interpret form (age) or to compute additional quantities that we expect to be relevant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Age of customer today </span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;Age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2020</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Year_Birth&quot;</span><span class="p">]</span>  <span class="c1"># which year to start?!</span>

<span class="c1">#Total spendings on various items</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;Spent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Dropping some of the redundant features</span>
<span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Year_Birth&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-processing">
<h4><span class="section-number">14.3.3.3. </span>Data processing<a class="headerlink" href="#data-processing" title="Link to this heading">#</a></h4>
<p>Dimensionality reduction techniques such as PCA require numerical data, which is not very surprising given how the method works (see above).
The most common pitfall, however, is that <strong>PCA is extremely sensitive to the scaling of the data</strong>. It looks for the features with the largest variance, so imagine that one feature is income, which can have values of many 10,000s and another feature is age, which will usually stay below 100. Then PCA will virtually ignore the feature “age” in comparison to the much higher values of the feature “income”. To circumvent this undesirable effect, the data needs to be <strong>scaled so that all features show comparable ranges</strong>.</p>
<p>Here, we will use the Scikit-Learn <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code> for this task.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Creating a copy of data (with only numerical values)</span>
<span class="n">data_numerical</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;number&#39;</span><span class="p">)</span>

<span class="c1"># Creating a subset of dataframe by dropping the features on deals accepted and promotions</span>
<span class="n">cols_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Complain&quot;</span><span class="p">,</span> <span class="s2">&quot;Response&quot;</span><span class="p">]</span>
<span class="n">data_numerical</span> <span class="o">=</span> <span class="n">data_numerical</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_remove</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Scaling</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_numerical</span><span class="p">)</span>
<span class="n">data_scaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_numerical</span><span class="p">),</span>
                           <span class="n">columns</span><span class="o">=</span> <span class="n">data_numerical</span><span class="o">.</span><span class="n">columns</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_scaled</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Income</th>
      <th>Kidhome</th>
      <th>Teenhome</th>
      <th>Recency</th>
      <th>MntWines</th>
      <th>MntFruits</th>
      <th>MntMeatProducts</th>
      <th>MntFishProducts</th>
      <th>MntSweetProducts</th>
      <th>MntGoldProds</th>
      <th>NumDealsPurchases</th>
      <th>NumWebPurchases</th>
      <th>NumCatalogPurchases</th>
      <th>NumStorePurchases</th>
      <th>NumWebVisitsMonth</th>
      <th>Age</th>
      <th>Spent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.603840</td>
      <td>-0.823405</td>
      <td>-0.930767</td>
      <td>-1.694318</td>
      <td>-0.347240</td>
      <td>1.950872</td>
      <td>0.981413</td>
      <td>1.336263</td>
      <td>3.936458</td>
      <td>3.362873</td>
      <td>-0.699147</td>
      <td>-0.036788</td>
      <td>0.484147</td>
      <td>0.054432</td>
      <td>-1.797341</td>
      <td>-0.093624</td>
      <td>0.969477</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.264092</td>
      <td>-0.823405</td>
      <td>-0.930767</td>
      <td>-1.694318</td>
      <td>0.467775</td>
      <td>-0.538100</td>
      <td>-0.465299</td>
      <td>-0.561124</td>
      <td>-0.659718</td>
      <td>-0.136437</td>
      <td>-0.699147</td>
      <td>1.059382</td>
      <td>0.126750</td>
      <td>0.362973</td>
      <td>-0.139645</td>
      <td>0.675400</td>
      <td>-0.049576</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.755487</td>
      <td>-0.823405</td>
      <td>0.906602</td>
      <td>-1.694318</td>
      <td>-0.510242</td>
      <td>-0.387253</td>
      <td>-0.488263</td>
      <td>-0.415171</td>
      <td>-0.611081</td>
      <td>-0.271770</td>
      <td>-0.699147</td>
      <td>-0.402177</td>
      <td>-0.230646</td>
      <td>-0.254109</td>
      <td>-1.382917</td>
      <td>0.931742</td>
      <td>-0.591519</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.924655</td>
      <td>1.038757</td>
      <td>0.906602</td>
      <td>-1.694318</td>
      <td>-0.877740</td>
      <td>-0.663806</td>
      <td>-0.754642</td>
      <td>-0.688833</td>
      <td>-0.659718</td>
      <td>-0.851766</td>
      <td>-0.699147</td>
      <td>-1.132957</td>
      <td>-0.945440</td>
      <td>-1.179732</td>
      <td>0.689203</td>
      <td>0.162718</td>
      <td>-0.990496</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.455841</td>
      <td>1.038757</td>
      <td>-0.930767</td>
      <td>-1.694318</td>
      <td>-0.889595</td>
      <td>-0.261548</td>
      <td>-0.649009</td>
      <td>-0.488148</td>
      <td>-0.659718</td>
      <td>-0.194437</td>
      <td>-0.168834</td>
      <td>-0.402177</td>
      <td>-0.588043</td>
      <td>-1.179732</td>
      <td>0.689203</td>
      <td>-1.717119</td>
      <td>-0.857504</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Finally, we can compute the PCA components for our data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_scaled</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_scaled</span><span class="p">)</span>
<span class="n">X_pca</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2205, 2)
</pre></div>
</div>
</div>
</div>
<p>As we see, the data (2205 datapoints) is now reduced to two dimensions. We will use these two dimensions to plot all datapoints using a scatter plot.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sb</span>

<span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_plot</span><span class="p">[[</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span> <span class="s2">&quot;pca2&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">X_pca</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pca2&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Income&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/7bb00adc2e84d621926574f35f121bc009de50660b898f6e2e925fb76f94bd92.png" src="../_images/7bb00adc2e84d621926574f35f121bc009de50660b898f6e2e925fb76f94bd92.png" />
</div>
</div>
<p>We can, obviously, freely choose which feature we want to use for coloring. It is also possible to add another feature for scaling the size of the dots.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;pca1&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;pca2&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Teenhome&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/42aff46e0c2a5afb8e63d0f01b1aacd4bdf7e3e8d40b871c1abdc28b0273874b.png" src="../_images/42aff46e0c2a5afb8e63d0f01b1aacd4bdf7e3e8d40b871c1abdc28b0273874b.png" />
</div>
</div>
</section>
</section>
<section id="non-linear-projections">
<h3><span class="section-number">14.3.4. </span>Non-linear Projections<a class="headerlink" href="#non-linear-projections" title="Link to this heading">#</a></h3>
<p>The PCA plots above show that the dimensionality reduction worked to quite some extent. How do we know this? Well, first we see that the points are not randomly distributed without any visible correlation to their features. We see that high- and low-income people are placed in different areas of the plot, and the same is true for other features as well.</p>
<p>Still, in many cases, PCA might not provide the best possible results. Mostly because of its main limitation: being a linear method. This can be seen particularly well in the plot, which uses the income for the dot color. This clearly shows a clear overall direction from low to high incomes.</p>
<p><strong>Why is this a problem?</strong><br />
A lot of data we care about is highly non-linear. And linear methods are then often not able to map the data onto fewer dimensions in an appropriate or sufficiently delicate &amp; complex manner. In the present case, we might get the impression that the plot -while it looks nice- may not tell us a lot of new things about our data.</p>
<p>In such cases, it is recommended to also try non-linear approaches. First, we will stay with the projection based methods and have a look at PCA variants that can handle non-linearity to some extend, such as <strong>kernel-PCA</strong>.</p>
</section>
<section id="pca-on-generated-2d-test-data">
<h3><span class="section-number">14.3.5. </span>PCA on generated 2D test data<a class="headerlink" href="#pca-on-generated-2d-test-data" title="Link to this heading">#</a></h3>
<p>We will now test a few methods with strongly non-linear generated 2D data to better understand what the above mentioned limitation means.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate fake data</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">200</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;crimson&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">100</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;teal&quot;</span><span class="p">])</span>
<span class="n">gen_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gen_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gen_data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/ffe75efd0e8162c4ba92e683fcff79b151fca8db9b77fdd95cd4b7c0a85d334b.png" src="../_images/ffe75efd0e8162c4ba92e683fcff79b151fca8db9b77fdd95cd4b7c0a85d334b.png" />
</div>
</div>
<p>First we will apply <strong>PCA</strong> to reduce this data to one dimension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c43bd8c1a6f5525c6705a2d5641f6887a55ba338a7200912ea01e9933b087bb2.png" src="../_images/c43bd8c1a6f5525c6705a2d5641f6887a55ba338a7200912ea01e9933b087bb2.png" />
</div>
</div>
<p>As we see from this plot, <strong>PCA</strong> is not able to separate the two different colors. This means it doesn not find a good lower dimensional representation of this particular dataset.</p>
</section>
<section id="kernel-pca">
<h3><span class="section-number">14.3.6. </span>Kernel-PCA<a class="headerlink" href="#kernel-pca" title="Link to this heading">#</a></h3>
<p>Kernel-PCA processes data in a higher-dimensional space, a technique often referred to as the “kernel trick.” A commonly used kernel function in this context is the Radial Basis Function (RBF).</p>
<p>Initially, this approach might seem counterintuitive. The objective of dimensionality reduction is to simplify data, so why first move it into a higher-dimensional space? The purpose of this step is to overcome the limitations of linear transformations, such as the principal axis transformation or rotation, found in PCA. By suitably projecting data into a higher-dimensional space, linear techniques can sometimes achieve more effective transformations, offering a more nuanced understanding of complex data sets.</p>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>A non-linear technique, capable of handling non-linear data.</p></li>
<li><p>Still relatively fast compared to other non-linear methods.</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>Requires optimization of additional parameters, such as the choice of kernel function and its parameters.</p></li>
<li><p>These parameters can significantly impact the results, making the process sensitive to these settings.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">KernelPCA</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span> <span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]):</span>
    <span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
                     <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                     <span class="n">fit_inverse_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">X_kpca</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_kpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_kpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gamma: </span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/754a692381b336660d8201907fa3a468144125ef9c1a5f90bba8e1dfc54e87f4.png" src="../_images/754a692381b336660d8201907fa3a468144125ef9c1a5f90bba8e1dfc54e87f4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span> <span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;poly&quot;</span><span class="p">,</span> <span class="s2">&quot;rbf&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine&quot;</span><span class="p">]):</span>
    <span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
                     <span class="n">gamma</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                     <span class="n">fit_inverse_transform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">X_kpca</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_kpca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_kpca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/73e28360ae0e5be7910271300c9c2f80fbbcb5a6c70e16f60f4ef87d59c039e3.png" src="../_images/73e28360ae0e5be7910271300c9c2f80fbbcb5a6c70e16f60f4ef87d59c039e3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpca</span> <span class="o">=</span> <span class="n">KernelPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> 
                 <span class="n">gamma</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_kpca</span> <span class="o">=</span> <span class="n">kpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_kpca</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3560ddac0bf1da6c651256b3b3bfc752eb63dcc73b824217f406ef03906a5ed7.png" src="../_images/3560ddac0bf1da6c651256b3b3bfc752eb63dcc73b824217f406ef03906a5ed7.png" />
</div>
</div>
<p>Here we see, that kernel-PCA is capable of keeping the two colors separate even after reducing all points to one dimension.</p>
</section>
</section>
<section id="feature-extraction-2-manifold-learning">
<h2><span class="section-number">14.4. </span>Feature Extraction 2: Manifold Learning<a class="headerlink" href="#feature-extraction-2-manifold-learning" title="Link to this heading">#</a></h2>
<p>Manifold Learning is a class of techniques designed for discovering the underlying structure or manifold of high-dimensional data. Unlike linear methods that attempt to preserve global linear relationships, manifold learning focuses on uncovering local structures, ideally capturing the intrinsic geometry of the data (see <a class="reference internal" href="#fig-manifolds"><span class="std std-numref">Fig. 14.3</span></a>). The central assumption of manifold learning is that the data of interest lies on an embedded non-linear manifold within the higher-dimensional space. By understanding this manifold, one can reduce the dimensionality while preserving the data’s essential characteristics, which is particularly useful for complex datasets where linear projections like PCA fall short.</p>
<figure class="align-default" id="fig-manifolds">
<img alt="../_images/fig_dimensionality_reduction_manifolds.png" src="../_images/fig_dimensionality_reduction_manifolds.png" />
<figcaption>
<p><span class="caption-number">Fig. 14.3 </span><span class="caption-text">Linear projections of highly non-linear data onto fewer dimensions are often far from ideal (left). A central goal in manifold learning is to find geometries that better represent the intrinsic structure of the data (right) thereby leading to much better dimensionality reduction results.</span><a class="headerlink" href="#fig-manifolds" title="Link to this image">#</a></p>
</figcaption>
</figure>
<section id="t-sne">
<h3><span class="section-number">14.4.1. </span>t-SNE<a class="headerlink" href="#t-sne" title="Link to this heading">#</a></h3>
<p>t-SNE, introduced by Maaten and Hinton in 2008, is a sophisticated technique that has rapidly gained popularity for its effectiveness in visualizing and reducing the dimensions of data that reside on complex manifolds {cite}maaten2008tsne. Unlike PCA, t-SNE is particularly suited for embedding high-dimensional data into a space of two or three dimensions, which makes it an excellent tool for visualizing data clusters.</p>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p><strong>Handling Non-Linearity</strong>: t-SNE excels in managing non-linear relationships in data, making it ideal for datasets where the underlying structure is intricate.</p></li>
<li><p><strong>Superior Visualization</strong>: It produces visually appealing results that highlight clusters and structures that are not apparent in linear dimensionality reduction outputs.</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p><strong>Computational Intensity</strong>: The technique is computationally intensive, particularly as the size of the dataset increases, making it less scalable than some linear methods.</p></li>
<li><p><strong>Parameter Sensitivity</strong>: t-SNE involves several hyperparameters such as the perplexity and learning rate, which require careful tuning to get meaningful results. The outcome of t-SNE can vary significantly with different settings of these parameters.</p></li>
</ul>
<p><strong>How t-SNE Works:</strong></p>
<ul class="simple">
<li><p><strong>Probability Distributions</strong>: t-SNE converts the distances between data points in high-dimensional space into conditional probabilities that represent similarities. The similarity of datapoint xjxj to datapoint xixi is the conditional probability that xixi would pick xjxj as its neighbor if neighbors were picked in proportion to their probability density under a Gaussian centered at xixi.</p></li>
<li><p><strong>KL Divergence Minimization</strong>: In the low-dimensional space, t-SNE similarly creates a probability distribution using a Student’s t-distribution to model the similarity between points. The optimization objective is to minimize the Kullback–Leibler divergence between the two distributions over the positions of points in the low-dimensional space. This divergence measures how much one probability distribution differs from a second, reference probability distribution.</p></li>
</ul>
<p><strong>Practical Considerations:</strong></p>
<ul class="simple">
<li><p><strong>Data Scaling</strong>: Similar to PCA, data should be scaled (standardized) before applying t-SNE to ensure that all features contribute equally.</p></li>
<li><p><strong>Dimensionality Curse</strong>: Although t-SNE is designed for high-dimensional data, excessively high dimensions can degrade its performance, often necessitating the use of an initial dimensionality reduction method like PCA before applying t-SNE.</p></li>
</ul>
<p>By focusing on local rather than global relationships, t-SNE can uncover intricate patterns in the data, making it highly suitable for exploratory data analysis and data visualization in tasks where understanding the data’s grouping and structure is crucial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>

<span class="n">perplexities</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">perplexities</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">perplexities</span><span class="p">)</span> <span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">perplexity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">perplexities</span><span class="p">):</span>
    <span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="n">perplexity</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">X_tsne</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;perplexity: </span><span class="si">{</span><span class="n">perplexity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/54d6f1f9ea59ef95c9e25695024ebdaefeed38c6d858fa48092fb65767634132.png" src="../_images/54d6f1f9ea59ef95c9e25695024ebdaefeed38c6d858fa48092fb65767634132.png" />
</div>
</div>
</section>
<section id="umap-uniform-manifold-approximation-and-projection">
<h3><span class="section-number">14.4.2. </span>UMAP (Uniform Manifold Approximation and Projection)<a class="headerlink" href="#umap-uniform-manifold-approximation-and-projection" title="Link to this heading">#</a></h3>
<p>UMAP is a relatively recent addition to dimensionality reduction techniques <span id="id1">[<a class="reference internal" href="../book/bibliography.html#id28" title="Leland McInnes, John Healy, and James Melville. Umap: uniform manifold approximation and projection for dimension reduction. arXiv preprint arXiv:1802.03426, 2018.">McInnes <em>et al.</em>, 2018</a>]</span>. It is particularly effective for large datasets and is known for preserving more of the global data structure compared to methods like t-SNE.</p>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>Efficient with large datasets.</p></li>
<li><p>Preserves more global structure, providing a broader view of data relationships.</p></li>
<li><p>Flexible and can be used in a variety of contexts.</p></li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul class="simple">
<li><p>Like other non-linear methods, it requires parameter tuning.</p></li>
<li><p>The results can be sensitive to these parameter choices.</p></li>
</ul>
</section>
<section id="comparison-and-application">
<h3><span class="section-number">14.4.3. </span>Comparison and Application<a class="headerlink" href="#comparison-and-application" title="Link to this heading">#</a></h3>
<p>Each of these techniques has unique strengths and weaknesses, making them suitable for different types of data and objectives. Kernel-PCA is a versatile tool for moderately complex data, while t-SNE and UMAP excel at revealing intricate structures in high-dimensional data.</p>
<p>The choice of technique depends on the specific requirements of the analysis, such as the need for speed (favoring Kernel-PCA), detail (favoring t-SNE), or a balance of structure preservation and speed (favoring UMAP). Understanding the nature of the dataset and the goals of the analysis is key to selecting the most appropriate dimensionality reduction method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">umap</span>

<span class="n">n_neighbors_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_neighbors_values</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_neighbors_values</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_neighbors</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_neighbors_values</span><span class="p">):</span>
    <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">X_umap</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_umap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_umap</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_neighbors: </span><span class="si">{</span><span class="n">n_neighbors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_neighbors</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_neighbors_values</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="n">X_umap</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">gen_data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_umap</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_umap</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_neighbors: </span><span class="si">{</span><span class="n">n_neighbors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/umap/umap_.py:2891,</span> in <span class="ni">UMAP.fit_transform</span><span class="nt">(self, X, y, force_all_finite)</span>
<span class="g g-Whitespace">   </span><span class="mi">2855</span> <span class="k">def</span> <span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_all_finite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2856</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Fit X into an embedded space and return that transformed</span>
<span class="g g-Whitespace">   </span><span class="mi">2857</span><span class="sd">     output.</span>
<span class="g g-Whitespace">   </span><span class="mi">2858</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">2889</span><span class="sd">         Local radii of data points in the embedding (log-transformed).</span>
<span class="g g-Whitespace">   </span><span class="mi">2890</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">2891</span>     <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">force_all_finite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2892</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_mode</span> <span class="o">==</span> <span class="s2">&quot;embedding&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2893</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dens</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/umap/umap_.py:2784,</span> in <span class="ni">UMAP.fit</span><span class="nt">(self, X, y, force_all_finite)</span>
<span class="g g-Whitespace">   </span><span class="mi">2780</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_mode</span> <span class="o">==</span> <span class="s2">&quot;embedding&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2781</span>     <span class="n">epochs</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2782</span>         <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs</span>
<span class="g g-Whitespace">   </span><span class="mi">2783</span>     <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2784</span>     <span class="bp">self</span><span class="o">.</span><span class="n">embedding_</span><span class="p">,</span> <span class="n">aux_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_embed_data</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2785</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">2786</span>         <span class="n">epochs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2787</span>         <span class="n">init</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2788</span>         <span class="n">random_state</span><span class="p">,</span>  <span class="c1"># JH why raw data?</span>
<span class="g g-Whitespace">   </span><span class="mi">2789</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2791</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_epochs_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2792</span>         <span class="k">if</span> <span class="s2">&quot;embedding_list&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aux_data</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/umap/umap_.py:2830,</span> in <span class="ni">UMAP._fit_embed_data</span><span class="nt">(self, X, n_epochs, init, random_state)</span>
<span class="g g-Whitespace">   </span><span class="mi">2826</span> <span class="k">def</span> <span class="nf">_fit_embed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2827</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;A method wrapper for simplicial_set_embedding that can be</span>
<span class="g g-Whitespace">   </span><span class="mi">2828</span><span class="sd">     replaced by subclasses.</span>
<span class="g g-Whitespace">   </span><span class="mi">2829</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">2830</span>     <span class="k">return</span> <span class="n">simplicial_set_embedding</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2831</span>         <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2832</span>         <span class="bp">self</span><span class="o">.</span><span class="n">graph_</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2833</span>         <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2834</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_initial_alpha</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2835</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2836</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2837</span>         <span class="bp">self</span><span class="o">.</span><span class="n">repulsion_strength</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2838</span>         <span class="bp">self</span><span class="o">.</span><span class="n">negative_sample_rate</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2839</span>         <span class="n">n_epochs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2840</span>         <span class="n">init</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2841</span>         <span class="n">random_state</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2842</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_input_distance_func</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2843</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_metric_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2844</span>         <span class="bp">self</span><span class="o">.</span><span class="n">densmap</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2845</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_densmap_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2846</span>         <span class="bp">self</span><span class="o">.</span><span class="n">output_dens</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2847</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_output_distance_func</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2848</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_output_metric_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2849</span>         <span class="bp">self</span><span class="o">.</span><span class="n">output_metric</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="s2">&quot;l2&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">2850</span>         <span class="bp">self</span><span class="o">.</span><span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2851</span>         <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2852</span>         <span class="n">tqdm_kwds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tqdm_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2853</span>     <span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/umap/umap_.py:1193,</span> in <span class="ni">simplicial_set_embedding</span><span class="nt">(data, graph, n_components, initial_alpha, a, b, gamma, negative_sample_rate, n_epochs, init, random_state, metric, metric_kwds, densmap, densmap_kwds, output_dens, output_metric, output_metric_kwds, euclidean_output, parallel, verbose, tqdm_kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1186</span> <span class="n">embedding</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1187</span>     <span class="mf">10.0</span>
<span class="g g-Whitespace">   </span><span class="mi">1188</span>     <span class="o">*</span> <span class="p">(</span><span class="n">embedding</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1189</span>     <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1190</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1192</span> <span class="k">if</span> <span class="n">euclidean_output</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1193</span>     <span class="n">embedding</span> <span class="o">=</span> <span class="n">optimize_layout_euclidean</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1194</span>         <span class="n">embedding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1195</span>         <span class="n">embedding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1196</span>         <span class="n">head</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1197</span>         <span class="n">tail</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1198</span>         <span class="n">n_epochs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1199</span>         <span class="n">n_vertices</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1200</span>         <span class="n">epochs_per_sample</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1201</span>         <span class="n">a</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1202</span>         <span class="n">b</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span>         <span class="n">rng_state</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1204</span>         <span class="n">gamma</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1205</span>         <span class="n">initial_alpha</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1206</span>         <span class="n">negative_sample_rate</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1207</span>         <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1208</span>         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1209</span>         <span class="n">densmap</span><span class="o">=</span><span class="n">densmap</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1210</span>         <span class="n">densmap_kwds</span><span class="o">=</span><span class="n">densmap_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1211</span>         <span class="n">tqdm_kwds</span><span class="o">=</span><span class="n">tqdm_kwds</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1212</span>         <span class="n">move_other</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1213</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1214</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1215</span>     <span class="n">embedding</span> <span class="o">=</span> <span class="n">optimize_layout_generic</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1216</span>         <span class="n">embedding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1217</span>         <span class="n">embedding</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1233</span>         <span class="n">move_other</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1234</span>     <span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/umap/layouts.py:380,</span> in <span class="ni">optimize_layout_euclidean</span><span class="nt">(head_embedding, tail_embedding, head, tail, n_epochs, n_vertices, epochs_per_sample, a, b, rng_state, gamma, initial_alpha, negative_sample_rate, parallel, verbose, densmap, densmap_kwds, tqdm_kwds, move_other)</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span>     <span class="n">dens_re_mean</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">    </span><span class="mi">378</span>     <span class="n">dens_re_cov</span> <span class="o">=</span> <span class="mi">0</span>
<span class="ne">--&gt; </span><span class="mi">380</span> <span class="n">optimize_fn</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span>     <span class="n">head_embedding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span>     <span class="n">tail_embedding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span>     <span class="n">head</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>     <span class="n">tail</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>     <span class="n">n_vertices</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>     <span class="n">epochs_per_sample</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span>     <span class="n">a</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>     <span class="n">b</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="n">rng_state</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>     <span class="n">gamma</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>     <span class="n">dim</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span>     <span class="n">move_other</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>     <span class="n">alpha</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>     <span class="n">epochs_per_negative_sample</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span>     <span class="n">epoch_of_next_negative_sample</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span>     <span class="n">epoch_of_next_sample</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span>     <span class="n">n</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span>     <span class="n">densmap_flag</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>     <span class="n">dens_phi_sum</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="n">dens_re_sum</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">dens_re_cov</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">dens_re_std</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="n">dens_re_mean</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">dens_lambda</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">dens_R</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">dens_mu</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span>     <span class="n">dens_mu_tot</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">initial_alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">)))</span>
<span class="g g-Whitespace">    </span><span class="mi">412</span> <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_epochs</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/dispatcher.py:420,</span> in <span class="ni">_DispatcherBase._compile_for_args</span><span class="nt">(self, *args, **kws)</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span> <span class="n">return_val</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">419</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">420</span>     <span class="n">return_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">argtypes</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">421</span> <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForceLiteralArg</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span>     <span class="c1"># Received request for compiler re-entry with the list of arguments</span>
<span class="g g-Whitespace">    </span><span class="mi">423</span>     <span class="c1"># indicated by e.requested_args.</span>
<span class="g g-Whitespace">    </span><span class="mi">424</span>     <span class="c1"># First, check if any of these args are already Literal-ized</span>
<span class="g g-Whitespace">    </span><span class="mi">425</span>     <span class="n">already_lit_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">requested_args</span>
<span class="g g-Whitespace">    </span><span class="mi">426</span>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">types</span><span class="o">.</span><span class="n">Literal</span><span class="p">)]</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/dispatcher.py:957,</span> in <span class="ni">Dispatcher.compile</span><span class="nt">(self, sig)</span>
<span class="g g-Whitespace">    </span><span class="mi">955</span> <span class="k">with</span> <span class="n">ev</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;numba:compile&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ev_details</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">956</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">957</span>         <span class="n">cres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">958</span>     <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForceLiteralArg</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span>         <span class="k">def</span> <span class="nf">folded</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kws</span><span class="p">):</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/dispatcher.py:125,</span> in <span class="ni">_FunctionCompiler.compile</span><span class="nt">(self, args, return_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span> <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">125</span>     <span class="n">status</span><span class="p">,</span> <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_cached</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>     <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>         <span class="k">return</span> <span class="n">retval</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/dispatcher.py:139,</span> in <span class="ni">_FunctionCompiler._compile_cached</span><span class="nt">(self, args, return_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span>     <span class="k">pass</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">139</span>     <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_core</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span> <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">TypingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_failed_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/dispatcher.py:152,</span> in <span class="ni">_FunctionCompiler._compile_core</span><span class="nt">(self, args, return_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_customize_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="n">impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_implementation</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">{})</span>
<span class="ne">--&gt; </span><span class="mi">152</span> <span class="n">cres</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile_extra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetdescr</span><span class="o">.</span><span class="n">typing_context</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>                               <span class="bp">self</span><span class="o">.</span><span class="n">targetdescr</span><span class="o">.</span><span class="n">target_context</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>                               <span class="n">impl</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span>                               <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>                               <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locals</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span>                               <span class="n">pipeline_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_class</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span> <span class="c1"># Check typing error if object mode is used</span>
<span class="g g-Whitespace">    </span><span class="mi">159</span> <span class="k">if</span> <span class="n">cres</span><span class="o">.</span><span class="n">typing_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flags</span><span class="o">.</span><span class="n">enable_pyobject</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler.py:751,</span> in <span class="ni">compile_extra</span><span class="nt">(typingctx, targetctx, func, args, return_type, flags, locals, library, pipeline_class)</span>
<span class="g g-Whitespace">    </span><span class="mi">727</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Compiler entry point</span>
<span class="g g-Whitespace">    </span><span class="mi">728</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">729</span><span class="sd"> Parameter</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">747</span><span class="sd">     compiler pipeline</span>
<span class="g g-Whitespace">    </span><span class="mi">748</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">749</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline_class</span><span class="p">(</span><span class="n">typingctx</span><span class="p">,</span> <span class="n">targetctx</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">750</span>                           <span class="n">args</span><span class="p">,</span> <span class="n">return_type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="nb">locals</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">751</span> <span class="k">return</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">compile_extra</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler.py:445,</span> in <span class="ni">CompilerBase.compile_extra</span><span class="nt">(self, func)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">lifted</span> <span class="o">=</span> <span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">lifted_from</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">445</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_bytecode</span><span class="p">()</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler.py:513,</span> in <span class="ni">CompilerBase._compile_bytecode</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">509</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span><span class="sd"> Populate and run pipeline for bytecode input</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">512</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">func_ir</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">513</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_core</span><span class="p">()</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler.py:479,</span> in <span class="ni">CompilerBase._compile_core</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">478</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">479</span>     <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">cr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">481</span>         <span class="k">break</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler_machinery.py:356,</span> in <span class="ni">PassManager.run</span><span class="nt">(self, state)</span>
<span class="g g-Whitespace">    </span><span class="mi">354</span> <span class="n">pass_inst</span> <span class="o">=</span> <span class="n">_pass_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pss</span><span class="p">)</span><span class="o">.</span><span class="n">pass_inst</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pass_inst</span><span class="p">,</span> <span class="n">CompilerPass</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">356</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_runPass</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">pass_inst</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span>     <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s2">&quot;Legacy pass in use&quot;</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler_lock.py:35,</span> in <span class="ni">_CompilerLock.__call__.&lt;locals&gt;._acquire_compile_lock</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">def</span> <span class="nf">_acquire_compile_lock</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="k">with</span> <span class="bp">self</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">35</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler_machinery.py:311,</span> in <span class="ni">PassManager._runPass</span><span class="nt">(self, index, pss, internal_state)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>     <span class="n">mutated</span> <span class="o">|=</span> <span class="n">check</span><span class="p">(</span><span class="n">pss</span><span class="o">.</span><span class="n">run_initialization</span><span class="p">,</span> <span class="n">internal_state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span> <span class="k">with</span> <span class="n">SimpleTimer</span><span class="p">()</span> <span class="k">as</span> <span class="n">pass_time</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">311</span>     <span class="n">mutated</span> <span class="o">|=</span> <span class="n">check</span><span class="p">(</span><span class="n">pss</span><span class="o">.</span><span class="n">run_pass</span><span class="p">,</span> <span class="n">internal_state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> <span class="k">with</span> <span class="n">SimpleTimer</span><span class="p">()</span> <span class="k">as</span> <span class="n">finalize_time</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span>     <span class="n">mutated</span> <span class="o">|=</span> <span class="n">check</span><span class="p">(</span><span class="n">pss</span><span class="o">.</span><span class="n">run_finalizer</span><span class="p">,</span> <span class="n">internal_state</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/compiler_machinery.py:273,</span> in <span class="ni">PassManager._runPass.&lt;locals&gt;.check</span><span class="nt">(func, compiler_state)</span>
<span class="g g-Whitespace">    </span><span class="mi">272</span> <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">compiler_state</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">273</span>     <span class="n">mangled</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">compiler_state</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="k">if</span> <span class="n">mangled</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span>         <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CompilerPass implementations should return True/False. &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span>                <span class="s2">&quot;CompilerPass with name &#39;</span><span class="si">%s</span><span class="s2">&#39; did not.&quot;</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/typed_passes.py:468,</span> in <span class="ni">BaseNativeLowering.run_pass</span><span class="nt">(self, state)</span>
<span class="g g-Whitespace">    </span><span class="mi">465</span> <span class="k">with</span> <span class="n">targetctx</span><span class="o">.</span><span class="n">push_code_library</span><span class="p">(</span><span class="n">library</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span>     <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowering_class</span><span class="p">(</span><span class="n">targetctx</span><span class="p">,</span> <span class="n">library</span><span class="p">,</span> <span class="n">fndesc</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span>                                 <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">468</span>     <span class="n">lower</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">469</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">flags</span><span class="o">.</span><span class="n">no_cpython_wrapper</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span>         <span class="n">lower</span><span class="o">.</span><span class="n">create_cpython_wrapper</span><span class="p">(</span><span class="n">flags</span><span class="o">.</span><span class="n">release_gil</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/lowering.py:187,</span> in <span class="ni">BaseLower.lower</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="bp">self</span><span class="o">.</span><span class="n">genlower</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">187</span>     <span class="bp">self</span><span class="o">.</span><span class="n">lower_normal_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fndesc</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>     <span class="bp">self</span><span class="o">.</span><span class="n">genlower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GeneratorLower</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/lowering.py:226,</span> in <span class="ni">BaseLower.lower_normal_function</span><span class="nt">(self, fndesc)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> <span class="c1"># Init argument values</span>
<span class="g g-Whitespace">    </span><span class="mi">225</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_function_arguments</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">226</span> <span class="n">entry_block_tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_function_body</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span> <span class="c1"># Close tail of entry block, do not emit debug metadata else the</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span> <span class="c1"># unconditional jump gets associated with the metadata from the function</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span> <span class="c1"># body end.</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> <span class="k">with</span> <span class="n">debuginfo</span><span class="o">.</span><span class="n">suspend_emission</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="p">):</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/lowering.py:256,</span> in <span class="ni">BaseLower.lower_function_body</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>     <span class="bp">self</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">position_at_end</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>     <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# lower block: </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">256</span>     <span class="bp">self</span><span class="o">.</span><span class="n">lower_block</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_lower</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="k">return</span> <span class="n">entry_block_tail</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/lowering.py:270,</span> in <span class="ni">BaseLower.lower_block</span><span class="nt">(self, block)</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span>     <span class="n">defaulterrcls</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">LoweringError</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span>     <span class="k">with</span> <span class="n">new_error_context</span><span class="p">(</span><span class="s1">&#39;lowering &quot;</span><span class="si">{inst}</span><span class="s1">&quot; at </span><span class="si">{loc}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">inst</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">269</span>                            <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">errcls_</span><span class="o">=</span><span class="n">defaulterrcls</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">270</span>         <span class="bp">self</span><span class="o">.</span><span class="n">lower_inst</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_block</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/parfors/parfor_lowering.py:51,</span> in <span class="ni">ParforLower.lower_inst</span><span class="nt">(self, inst)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> <span class="k">def</span> <span class="nf">lower_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inst</span><span class="p">,</span> <span class="n">parfor</span><span class="o">.</span><span class="n">Parfor</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="n">_lower_parfor_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">lower_inst</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/parfors/parfor_lowering.py:67,</span> in <span class="ni">_lower_parfor_parallel</span><span class="nt">(lowerer, parfor)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span> <span class="k">def</span> <span class="nf">_lower_parfor_parallel</span><span class="p">(</span><span class="n">lowerer</span><span class="p">,</span> <span class="n">parfor</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>     <span class="k">if</span> <span class="n">parfor</span><span class="o">.</span><span class="n">lowerer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">67</span>         <span class="k">return</span> <span class="n">_lower_parfor_parallel_std</span><span class="p">(</span><span class="n">lowerer</span><span class="p">,</span> <span class="n">parfor</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>         <span class="k">return</span> <span class="n">parfor</span><span class="o">.</span><span class="n">lowerer</span><span class="p">(</span><span class="n">lowerer</span><span class="p">,</span> <span class="n">parfor</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/parfors/parfor_lowering.py:381,</span> in <span class="ni">_lower_parfor_parallel_std</span><span class="nt">(lowerer, parfor)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loop_nests = &quot;</span><span class="p">,</span> <span class="n">parfor</span><span class="o">.</span><span class="n">loop_nests</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loop_ranges = &quot;</span><span class="p">,</span> <span class="n">loop_ranges</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">381</span> <span class="n">call_parallel_gufunc</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span>     <span class="n">lowerer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span>     <span class="n">func</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>     <span class="n">gu_signature</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>     <span class="n">func_sig</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>     <span class="n">func_args</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span>     <span class="n">func_arg_types</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>     <span class="n">loop_ranges</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="n">parfor_redvars</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>     <span class="n">parfor_reddict</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>     <span class="n">redarrs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span>     <span class="n">parfor</span><span class="o">.</span><span class="n">init_block</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>     <span class="n">index_var_typ</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>     <span class="n">parfor</span><span class="o">.</span><span class="n">races</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span>     <span class="n">exp_name_to_tuple_var</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> <span class="k">if</span> <span class="n">nredvars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span>     <span class="n">_parfor_lowering_finalize_reduction</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>         <span class="n">parfor</span><span class="p">,</span> <span class="n">redarrs</span><span class="p">,</span> <span class="n">lowerer</span><span class="p">,</span> <span class="n">parfor_reddict</span><span class="p">,</span> <span class="n">num_threads_var</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/parfors/parfor_lowering.py:1993,</span> in <span class="ni">call_parallel_gufunc</span><span class="nt">(lowerer, cres, gu_signature, outer_sig, expr_args, expr_arg_types, loop_ranges, redvars, reddict, redarrdict, init_block, index_var_typ, races, exp_name_to_tuple_var)</span>
<span class="g g-Whitespace">   </span><span class="mi">1988</span> <span class="n">fnty</span> <span class="o">=</span> <span class="n">llvmlite</span><span class="o">.</span><span class="n">ir</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span><span class="n">llvmlite</span><span class="o">.</span><span class="n">ir</span><span class="o">.</span><span class="n">VoidType</span><span class="p">(),</span>
<span class="g g-Whitespace">   </span><span class="mi">1989</span>                                 <span class="p">[</span><span class="n">byte_ptr_ptr_t</span><span class="p">,</span> <span class="n">intp_ptr_t</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1990</span>                                  <span class="n">intp_ptr_t</span><span class="p">,</span> <span class="n">byte_ptr_t</span><span class="p">])</span>
<span class="g g-Whitespace">   </span><span class="mi">1992</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">cgutils</span><span class="o">.</span><span class="n">get_or_insert_function</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="n">fnty</span><span class="p">,</span> <span class="n">wrapper_name</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1993</span> <span class="n">context</span><span class="o">.</span><span class="n">active_code_library</span><span class="o">.</span><span class="n">add_linking_library</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">library</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1995</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">DEBUG_ARRAY_OPT</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1996</span>     <span class="n">cgutils</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="s2">&quot;before calling kernel %p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/codegen.py:720,</span> in <span class="ni">CPUCodeLibrary.add_linking_library</span><span class="nt">(self, library)</span>
<span class="g g-Whitespace">    </span><span class="mi">719</span> <span class="k">def</span> <span class="nf">add_linking_library</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">library</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">720</span>     <span class="n">library</span><span class="o">.</span><span class="n">_ensure_finalized</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">721</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_linking_libraries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">library</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/codegen.py:567,</span> in <span class="ni">CodeLibrary._ensure_finalized</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span> <span class="k">def</span> <span class="nf">_ensure_finalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalized</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">567</span>         <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/codegen.py:762,</span> in <span class="ni">CPUCodeLibrary.finalize</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">756</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_final_module</span><span class="o">.</span><span class="n">link_in</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">757</span>             <span class="n">library</span><span class="o">.</span><span class="n">_get_module_for_linking</span><span class="p">(),</span> <span class="n">preserve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">758</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">760</span> <span class="c1"># Optimize the module after all dependences are linked in above,</span>
<span class="g g-Whitespace">    </span><span class="mi">761</span> <span class="c1"># to allow for inlining.</span>
<span class="ne">--&gt; </span><span class="mi">762</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_final_module</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">764</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_module</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">765</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_final_module</span><span class="p">()</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/numba/core/codegen.py:682,</span> in <span class="ni">CPUCodeLibrary._optimize_final_module</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span> <span class="n">full_name</span> <span class="o">=</span> <span class="s2">&quot;Module passes (full optimization)&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">680</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recorded_timings</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">full_name</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">681</span>     <span class="c1"># The full optimisation suite is then run on the refop pruned IR</span>
<span class="ne">--&gt; </span><span class="mi">682</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_codegen</span><span class="o">.</span><span class="n">_mpm_full</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_final_module</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/llvmlite/binding/passmanagers.py:693,</span> in <span class="ni">ModulePassManager.run</span><span class="nt">(self, module, remarks_file, remarks_format, remarks_filter)</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span><span class="sd"> Run optimization passes on the given module.</span>
<span class="g g-Whitespace">    </span><span class="mi">680</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span><span class="sd">     The filter that should be applied to the remarks output.</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span> <span class="k">if</span> <span class="n">remarks_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">693</span>     <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">LLVMPY_RunPassManager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">695</span>     <span class="n">r</span> <span class="o">=</span> <span class="n">ffi</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">LLVMPY_RunPassManagerWithRemarks</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">696</span>         <span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">_encode_string</span><span class="p">(</span><span class="n">remarks_format</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">697</span>         <span class="n">_encode_string</span><span class="p">(</span><span class="n">remarks_filter</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">698</span>         <span class="n">_encode_string</span><span class="p">(</span><span class="n">remarks_file</span><span class="p">))</span>

<span class="nn">File ~/micromamba/envs/data_science/lib/python3.10/site-packages/llvmlite/binding/ffi.py:192,</span> in <span class="ni">_lib_fn_wrapper.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span>     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">192</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cfn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
<img alt="../_images/b47e6e0ab06e8ba6fedaaa2329bf9ed1e02697821b5720bfcf9cd6ebde0c95ba.png" src="../_images/b47e6e0ab06e8ba6fedaaa2329bf9ed1e02697821b5720bfcf9cd6ebde0c95ba.png" />
</div>
</div>
</section>
<section id="use-case-marketing-analysis-t-sne">
<h3><span class="section-number">14.4.4. </span>Use case: Marketing Analysis (t-SNE)<a class="headerlink" href="#use-case-marketing-analysis-t-sne" title="Link to this heading">#</a></h3>
<p>Let us now continue with our use case of the marketing dataset. Before we used PCA which did work to some extent, but maybe not as well as we wanted. Let’s compare this to using t-SNE for reducing the datapoints to only two dimensions so that we can visualize all data points in a 2D scatter plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>

<span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">perplexity</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
           <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_tsne</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_plot</span><span class="p">[[</span><span class="s2">&quot;tsne1&quot;</span><span class="p">,</span> <span class="s2">&quot;tsne2&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">X_tsne</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;tsne1&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;tsne2&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Income&quot;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/264a8cd1ef2339d8908980ec42585f27a9a30f4ab1f64f1d049019de6be56563.png" src="../_images/264a8cd1ef2339d8908980ec42585f27a9a30f4ab1f64f1d049019de6be56563.png" />
</div>
</div>
<p>We can of course, also plot several features in parallel by combining multiple plots.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Income&quot;</span><span class="p">,</span> <span class="s2">&quot;Spent&quot;</span><span class="p">,</span> <span class="s2">&quot;Kidhome&quot;</span><span class="p">,</span> <span class="s2">&quot;Teenhome&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Education&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span>
                   <span class="n">x</span><span class="o">=</span><span class="s2">&quot;tsne1&quot;</span><span class="p">,</span>
                   <span class="n">y</span><span class="o">=</span><span class="s2">&quot;tsne2&quot;</span><span class="p">,</span>
                   <span class="n">hue</span><span class="o">=</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                   <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/a9a41fa18d0409026382015181f7ab0cd02d687e480d8e2487374fad50373f18.png" src="../_images/a9a41fa18d0409026382015181f7ab0cd02d687e480d8e2487374fad50373f18.png" />
</div>
</div>
</section>
</section>
<section id="conclusions">
<h2><span class="section-number">14.5. </span>Conclusions<a class="headerlink" href="#conclusions" title="Link to this heading">#</a></h2>
<p>It can be hard to judge whether one particular dimensionality reduction result is better or worse than another. What should have become clear, though, is that the non-linear techniques are capable of revealing more complex relationships and patterns. In the case of the marketing data, the t-SNE result reveals a much clearer structure, suggesting different customer groups.</p>
<p><strong>Why not always use t-SNE or UMAP then?</strong><br />
While both techniques are very popular and generally work quite well, they come with some severe disadvantages. First, all the non-linear methods require additional parameters that need adjusting. This automatically brings a larger workload for us as data scientists, but it also commonly raises questions on how to best select the “right” parameters. Do we choose the prettiest plot or a random one, or should we define quantitative criteria …</p>
<p>In practice, people will often simply play around with the key parameters and pick the result that fits their story best. While there is a lot of research on how to optimize and evaluate such results, this remains a complex -and often inconclusive- matter.</p>
<p>Finally, performance is also a key factor!<br />
If it comes to a fast reduction of large sets of high-dimensional data, PCA is often still the go-to technique. Implementations of slower tools such as t-NSE are hence often combined with PCA or similar methods.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="live_coding_06b_introduction_outlier_detection.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">13. </span>Outlier Detection</p>
      </div>
    </a>
    <a class="right-next"
       href="live_coding_08_machine_learning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">15. </span>Machine Learning - Introduction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-dimensionality-reduction">14.1. Introduction to Dimensionality Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-challenge-of-high-dimensional-data">14.1.1. The Challenge of High-Dimensional Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-implications">14.1.2. Practical Implications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-dimensionality-reduction">14.1.3. The Role of Dimensionality Reduction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">14.2. Feature Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-1-feature-projection">14.3. Feature Extraction 1: Feature Projection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-projection">14.3.1. Feature Projection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-principal-component-analysis">14.3.2. PCA (Principal Component Analysis)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#concept">14.3.2.1. Concept</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-example-with-python">14.3.2.2. Practical Example with Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-synthetic-data">14.3.2.3. Generating Synthetic Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pca">14.3.2.4. Applying PCA</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-marketing-analysis-with-pca">14.3.3. Use Case: Marketing Analysis (with PCA)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-import-and-inspection">14.3.3.1. Data import and inspection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-cleaning">14.3.3.2. Data cleaning</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-processing">14.3.3.3. Data processing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-linear-projections">14.3.4. Non-linear Projections</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-on-generated-2d-test-data">14.3.5. PCA on generated 2D test data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-pca">14.3.6. Kernel-PCA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-2-manifold-learning">14.4. Feature Extraction 2: Manifold Learning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#t-sne">14.4.1. t-SNE</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#umap-uniform-manifold-approximation-and-projection">14.4.2. UMAP (Uniform Manifold Approximation and Projection)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-and-application">14.4.3. Comparison and Application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-marketing-analysis-t-sne">14.4.4. Use case: Marketing Analysis (t-SNE)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusions">14.5. Conclusions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Florian Huber
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>